<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>塔吊登記表</title>
<style>
body { font-family: Arial; padding: 10px; background: #eef1f5; }
.container { max-width: 500px; margin: auto; background: #fff; padding: 15px; border-radius: 12px; overflow: visible; }
input, select, button { width: 100%; padding: 10px; margin-top: 6px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
button { background: #0069d9; color: white; border: none; margin-top: 12px; cursor: pointer; }
button.deleteBtn { background: #dc3545; padding: 5px 10px; font-size: 14px; cursor: pointer; }
table { width: 100%; margin-top: 15px; border-collapse: collapse; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #f2f2f2; }
</style>
</head>
<body>

<div class="container">
    <h2>塔吊登記表</h2>

    <label>日期</label>
    <input type="date" id="date">

    <label>工程項目</label>
    <select id="item">
        <option>A棟模板</option>
        <option>A棟鋼筋</option>
        <option>A棟鷹架</option>
        <option>A棟水電</option>
        <option>A棟其他</option>
        <option>B棟模板</option>
        <option>B棟鋼筋</option>
        <option>B棟鷹架</option>
        <option>B棟水電</option>
        <option>B棟其他</option>
        <option>C棟模板</option>
        <option>C棟鋼筋</option>
        <option>C棟鷹架</option>
        <option>C棟水電</option>
        <option>C棟其他</option>
    </select>

    <button type="button" onclick="addRow()">新增登記</button>

    <table id="dataTable">
        <thead>
            <tr>
                <th>日期</th>
                <th>項目</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyC1s8DdFy44PI3D4U04omK-G9A8Ftq-y2ng3f6sirmvTWJ7AasLC_cIww9_ERcS5QADA/exec"; // 

function loadData(){
    fetch(API_URL)
    .then(res => res.json())
    .then(data => {
        const tbody = document.getElementById("dataTable").querySelector("tbody");
        tbody.innerHTML = "";
        data.forEach(item => {
            const row = tbody.insertRow();
            let bgColor = "";
            if(item.item.startsWith("A")) bgColor="#cce5ff";
            else if(item.item.startsWith("B")) bgColor="#d4edda";
            else if(item.item.startsWith("C")) bgColor="#fff3cd";
            row.style.backgroundColor = bgColor;

            row.insertCell(0).innerText = item.date;
            row.insertCell(1).innerText = item.item;

            const btnCell = row.insertCell(2);
            const btn = document.createElement("button");
            btn.innerText = "刪除";
            btn.className = "deleteBtn";
            btn.onclick = () => deleteRow(item.id);
            btnCell.appendChild(btn);
        });
    })
    .catch(err=>console.error("載入資料錯誤:",err));
}

function addRow(){
    try {
        const date = document.getElementById("date").value;
        const item = document.getElementById("item").value;
        console.log("新增登記:", date, item);

        if(!date) return alert("請選擇日期");

        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({action:"add", date:date, item:item}),
            headers: {"Content-Type":"application/json"}
        })
        .then(res => res.json())
        .then(data => {
            console.log("新增成功:", data);
            loadData();
        })
        .catch(err=>console.error("新增資料錯誤:",err));
    } catch(e) {
        console.error("addRow() 錯誤:", e);
    }
}

function deleteRow(id){
    fetch(API_URL, {
        method:"POST",
        body: JSON.stringify({action:"delete", id:id}),
        headers: {"Content-Type":"application/json"}
    })
    .then(res=>res.json())
    .then(()=> loadData())
    .catch(err=>console.error("刪除資料錯誤:",err));
}

window.onload = loadData;
</script>

</body>
</html>

